<div class="container mt-4">
    <h1 class="mb-4">Danh Sách Khách Hàng</h1>

    <!-- Thanh điều hướng -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div class="d-flex">
            <input
                type="text"
                class="form-control me-2"
                placeholder="Nhập thông tin cần tìm..."
                style="max-width: 200px;"
            />
            <button type="submit" class="btn btn-primary">Tìm kiếm</button>
        </div>

        <!-- Nút Thêm Mới -->
        <button
            type="button"
            class="btn btn-success"
            data-bs-toggle="modal"
            data-bs-target="#addCustomerModal"
        >
            <i class="fas fa-plus"></i> Thêm mới
        </button>
    </div>

    <!-- Bảng Danh Sách -->
    <table class="table table-striped" id="customerTable">
        <thead>
            <tr>
                <th>Mã KH</th>
                <th>Họ Tên</th>
                <th>Ngày Sinh</th>
                <th>Email</th>
                <th>Số Điện Thoại</th>
                <th>Địa Chỉ</th>
                <th>Hành Động</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var kh in Model)
            {
                <tr>
                    <td>@kh.MaKH</td>
                    <td>@kh.Hoten</td>
                    <td>@kh.Ngaysinh.ToString("dd/MM/yyyy")</td>
                    <td>@kh.Email</td>
                    <td>@kh.Sdt</td>
                    <td>@kh.Diachi</td>
                    <td>
                        <button class="btn btn-warning btn-sm me-1">
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-trash"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 7l16 0" /><path d="M10 11l0 6" /><path d="M14 11l0 6" /><path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" /><path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" /></svg>
                        </button>
                        <button class="btn btn-danger btn-sm">
                           <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-edit"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1" /><path d="M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z" /><path d="M16 5l3 3" /></svg>
                        </button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<!-- Modal Thêm Mới -->
<div
    class="modal fade"
    id="addCustomerModal"
    tabindex="-1"
    aria-labelledby="addCustomerModalLabel"
    aria-hidden="true"
>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addCustomerModalLabel">Thêm Khách Hàng</h5>
                <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Close"
                ></button>
            </div>
            <div class="modal-body">
                <form id="addCustomerForm">
                    <div class="mb-3">
                        <label for="MaKH" class="form-label">Mã KH</label>
                        <input
                            type="text"
                            id="MaKH"
                            name="MaKH"
                            class="form-control"
                            placeholder="Nhập mã khách hàng"
                            required
                        />
                    </div>
                    <div class="mb-3">
                        <label for="Hoten" class="form-label">Họ Tên</label>
                        <input
                            type="text"
                            id="Hoten"
                            name="Hoten"
                            class="form-control"
                            placeholder="Nhập họ tên"
                            required
                        />
                    </div>
                    <div class="mb-3">
                        <label for="Ngaysinh" class="form-label">Ngày Sinh</label>
                        <input
                            type="date"
                            id="Ngaysinh"
                            name="Ngaysinh"
                            class="form-control"
                            required
                        />
                    </div>
                    <div class="mb-3">
                        <label for="Email" class="form-label">Email</label>
                        <input
                            type="email"
                            id="Email"
                            name="Email"
                            class="form-control"
                            placeholder="Nhập email"
                            required
                        />
                    </div>
                    <div class="mb-3">
                        <label for="Sdt" class="form-label">Số Điện Thoại</label>
                        <input
                            type="text"
                            id="Sdt"
                            name="Sdt"
                            class="form-control"
                            placeholder="Nhập số điện thoại"
                            required
                        />
                    </div>
                    <div class="mb-3">
                        <label for="Diachi" class="form-label">Địa Chỉ</label>
                        <input
                            type="text"
                            id="Diachi"
                            name="Diachi"
                            class="form-control"
                            placeholder="Nhập địa chỉ"
                            required
                        />
                    </div>
                    <div class="d-grid">
                        <button type="button" class="btn btn-success" onclick="saveCustomer()">Lưu</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
   function saveCustomer() {
    const customer = {
        Hoten: document.getElementById("Hoten").value.trim(),
        Ngaysinh: new Date(document.getElementById("Ngaysinh").value).toISOString().slice(0, 10),
        Email: document.getElementById("Email").value.trim(),
        Sdt: document.getElementById("Sdt").value.trim(),
        Diachi: document.getElementById("Diachi").value.trim()
    };

    const errorMessage = validateCustomer(customer);
    if (errorMessage) {
        alert(errorMessage);
        return;
    }

    $.ajax({
        url: '/KhachHang/Create',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(customer),
        success: function (result) {
            $('#addCustomerModal').modal('hide');

            const newRow = document.createElement("tr");
            newRow.innerHTML = `
                <td>${result.maKH}</td>
                <td>${result.hoten}</td>
                <td>${new Date(result.ngaysinh).toLocaleDateString()}</td>
                <td>${result.email}</td>
                <td>${result.sdt}</td>
                <td>${result.diachi}</td>
                <td>
                    <button class="btn btn-warning btn-sm me-1">...</button>
                    <button class="btn btn-danger btn-sm">...</button>
                </td>`;
            document.querySelector("#customerTable tbody").appendChild(newRow);

            document.getElementById("addCustomerForm").reset();
        },
        error: function (xhr, status, error) {
            console.error("Error:", xhr.responseText || status || error);
            alert("Đã xảy ra lỗi khi thêm khách hàng. Vui lòng thử lại.");
        }
    });
}



</script>
